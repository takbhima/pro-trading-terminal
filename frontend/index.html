
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pro Trading Terminal</title>
<script src="https://s3.tradingview.com/tv.js"></script>
<style>
body { margin:0; background:#0b1220; color:white; font-family:Arial; }
.grid { display:grid; grid-template-columns:3fr 1fr; grid-template-rows:70vh 30vh; gap:5px; height:100vh; }
.panel { background:#111827; border-radius:6px; padding:5px; overflow:auto; }
#chart { grid-column:1; grid-row:1 / span 2; }
#optionChain { grid-column:2; grid-row:1; }
#strategy { grid-column:2; grid-row:2; }
</style>
</head>
<body>

<div class="grid">
    <div id="chart" class="panel"></div>
    <div id="optionChain" class="panel"></div>
    <div id="strategy" class="panel">
        <h3>Live Tick</h3>
        <div id="livePrice">Connecting...</div>
    </div>
</div>

<script>
new TradingView.widget({
    container_id: "chart",
    width: "100%",
    height: "100%",
    symbol: "NSE:CANBK",
    interval: "5",
    timezone: "Asia/Kolkata",
    theme: "dark",
    studies: ["RSI@tv-basicstudies","MACD@tv-basicstudies","Volume@tv-basicstudies"]
});

async function loadOptionChain() {
    const res = await fetch("/option-chain/CANBK");
    const data = await res.json();
    document.getElementById("optionChain").innerHTML =
        "<pre>" + JSON.stringify(data.records?.data?.slice(0,5), null, 2) + "</pre>";
}
loadOptionChain();

const ws = new WebSocket(`ws://${location.host}/ws`);
ws.onmessage = function(event) {
    const data = JSON.parse(event.data);
    document.getElementById("livePrice").innerText = "â‚¹ " + data.price;
};
</script>

</body>
</html>
